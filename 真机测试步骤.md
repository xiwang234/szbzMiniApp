# 🧪 真机测试步骤

## 📋 当前状态

✅ **已完成:**
- 页面预览HTML已打开，可查看页面效果
- 代码逻辑已实现完成
- 签名算法已对齐

⚠️ **需要在微信开发者工具中测试真实接口调用**

---

## 🎯 测试方式对比

### 方式一: 浏览器预览 (当前已打开)
✅ **可以看到:**
- 首页表单的UI样式
- 性别选择交互效果
- 按钮点击后的跳转效果
- 控制台日志输出

❌ **无法测试:**
- 真实的微信API调用 (wx.request)
- 后端接口的实际响应
- 小程序特有的导航功能

### 方式二: 微信开发者工具 (推荐)
✅ **完整功能测试:**
- 真实的接口调用
- 后端数据返回
- 签名验证
- 页面跳转

---

## 🚀 在微信开发者工具中测试

### 第一步: 启动后端服务

打开命令行窗口:
```bash
cd D:\project\szbz
mvn spring-boot:run
```

等待看到:
```
Started SzbzApiApplication in 3.xxx seconds
```

### 第二步: 打开微信开发者工具

1. **启动开发者工具**
   - 打开微信开发者工具

2. **导入项目**
   - 点击 `导入项目`
   - 选择目录: `d:\project\szbzMiniApp`
   - AppID: 使用测试号即可

3. **配置开发设置**
   - 点击右上角 `详情`
   - 本地设置 → 勾选 `不校验合法域名、web-view、TLS版本及HTTPS证书`
   - 项目配置 → 确认 `ES6 转 ES5` 已勾选

### 第三步: 观察首页效果

✅ **应该看到:**
- 红色顶部导航栏 "生辰八字"
- 白色表单卡片
- 性别选择按钮 (男/女)
- 出生年月日选择器
- 时辰选择器
- 红色提交按钮 "照见本心"

### 第四步: 测试交互功能

#### 测试1: 性别切换
- 点击 `男` 按钮 → 应该变成蓝色渐变
- 点击 `女` 按钮 → 应该变成粉红色渐变

#### 测试2: 日期选择
- 点击年份选择器 → 弹出1950-2099年列表
- 点击月份选择器 → 弹出1-12月列表
- 点击日期选择器 → 弹出对应天数列表
- 点击时辰选择器 → 弹出12个时辰列表

### 第五步: 测试按钮点击和接口调用

#### 1. 填写测试数据
```
性别: 男
出生年份: 2014年
出生月份: 6月
出生日期: 15日
出生时辰: 午时 (11:00-12:59)
```

#### 2. 打开控制台
- 点击开发者工具底部的 `Console` 标签

#### 3. 点击提交按钮
- 点击 `照见本心` 按钮

#### 4. 观察控制台日志

**应该看到以下日志:**

```javascript
请求参数: {
  openId: "test_openid_1734422400000",
  gender: "male",
  year: 2014,
  month: 6,
  day: 15,
  hour: 11
}

时间戳: 1734422400000

签名: a1b2c3d4e5f6... (32位MD5值)
```

#### 5. 观察网络请求

在 `Network` 标签查看:
- **Request URL:** `http://localhost:8080/api/bazi/analyze`
- **Request Method:** POST
- **Request Headers:**
  - Content-Type: application/json
  - X-Timestamp: 1734422400000
  - X-Sign: [MD5签名]
- **Request Payload:** {openId, gender, year, month, day, hour}

#### 6. 观察页面跳转

**成功情况:**
- 页面自动跳转到 `info` 页面
- 显示 "正在分析中..." 加载动画
- 1-3秒后显示分析结果

**失败情况:**
- 显示错误提示
- 可点击 "重新加载" 按钮

### 第六步: 验证接口返回数据

#### 查看成功响应

在 `Network` 标签点击请求，查看 `Response`:

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "baziResult": {
      "fourPillars": {
        "year": { "tianGan": "甲", "diZhi": "午" },
        "month": { "tianGan": "庚", "diZhi": "午" },
        "day": { "tianGan": "戊", "diZhi": "申" },
        "hour": { "tianGan": "壬", "diZhi": "午" }
      }
    },
    "aiAnalysis": "详细的AI分析内容..."
  },
  "token": "eyJhbGciOiJIUzI1NiJ9...",
  "timestamp": 1734422400000
}
```

#### 查看页面展示效果

info页面应该显示:

```
【基本信息】
性别：男
出生时间：2014年6月15日 11时

【生辰八字】
年柱：甲午
月柱：庚午
日柱：戊申
时柱：壬午

【AI智能分析】
(Gemini API返回的分析内容)
```

---

## 🔍 关键验证点

### ✅ 功能验证清单

- [ ] 首页UI显示正常
- [ ] 性别切换有视觉反馈
- [ ] 日期选择器正常工作
- [ ] 时辰转换为小时数正确 (午时 → 11)
- [ ] 点击按钮触发请求
- [ ] 控制台输出请求参数
- [ ] 控制台输出时间戳和签名
- [ ] 发起POST请求到localhost:8080
- [ ] 请求头包含X-Timestamp和X-Sign
- [ ] 页面跳转到info页
- [ ] 显示加载动画
- [ ] 接收到后端响应
- [ ] 解析八字数据
- [ ] 解析AI分析数据
- [ ] 格式化展示内容

---

## 🐛 常见问题排查

### 问题1: 点击按钮无反应

**检查:**
1. 控制台是否有报错
2. `index.js` 中 `handleSubmit` 方法是否定义
3. `index.wxml` 中按钮绑定是否正确: `bindtap="handleSubmit"`

**解决:**
```javascript
// index.js 确保有此方法
handleSubmit() {
  const { gender, year, month, day, time } = this.data
  const hour = this.convertTimeToHour(time)
  
  wx.navigateTo({
    url: `/pages/info/info?gender=${gender}&year=${year}&month=${month}&day=${day}&hour=${hour}`
  })
}
```

### 问题2: 页面不跳转

**检查:**
1. 控制台是否提示路径错误
2. `app.json` 中是否注册了 `pages/info/info`
3. `info.js` 文件是否存在

**解决:**
确保 `app.json` 包含:
```json
{
  "pages": [
    "pages/index/index",
    "pages/info/info"
  ]
}
```

### 问题3: 接口请求失败

**检查:**
1. 后端是否启动 (访问 http://localhost:8080)
2. 是否关闭域名校验
3. 网络请求URL是否正确

**解决:**
- 确保后端运行在 8080 端口
- 详情 → 不校验合法域名

### 问题4: 签名验证失败

**检查:**
1. 前后端签名密钥是否一致
2. 时间戳格式是否正确
3. 参数排序是否一致

**解决:**
运行签名对比测试:
```bash
# 前端
const test = require('./utils/test-crypto.js')
test.runAllTests()

# 后端
mvn test -Dtest=SignatureUtilTest
```

对比输出的签名是否一致

### 问题5: 显示"请求已过期"

**原因:** 后端限制时间戳在2秒内有效

**解决:**
- 确保系统时间准确
- 检查前后端服务器时间同步

---

## 📊 测试数据记录

### 测试用例表格

| 用例ID | 性别 | 出生日期 | 时辰 | 期望结果 | 实际结果 | 状态 |
|--------|------|---------|------|---------|---------|------|
| TC01 | 男 | 2014-06-15 | 午时 | 正常显示 | | ⬜ |
| TC02 | 女 | 1990-12-25 | 辰时 | 正常显示 | | ⬜ |
| TC03 | 男 | 1950-01-01 | 子时 | 正常显示 | | ⬜ |

### 性能记录

| 指标 | 目标值 | 实际值 |
|------|--------|--------|
| 页面加载时间 | <1s | |
| 接口响应时间 | <3s | |
| UI交互延迟 | <100ms | |

---

## 📸 测试截图建议

建议截取以下关键界面:
1. 首页初始状态
2. 填写完成状态
3. 控制台日志
4. Network请求详情
5. info页加载状态
6. 最终展示结果

---

## ✅ 验收标准

**前后端联调成功的标志:**

1. ✅ 首页UI完美展示
2. ✅ 按钮点击有日志输出
3. ✅ 时辰正确转换为小时数
4. ✅ 发起HTTP POST请求
5. ✅ 请求包含正确的签名
6. ✅ 后端返回200状态码
7. ✅ 页面跳转到info页
8. ✅ 展示八字和AI分析

**全部通过即表示联调完成! 🎉**

---

## 📞 技术支持

遇到问题? 按以下顺序排查:
1. 查看本文档的常见问题部分
2. 检查控制台错误日志
3. 参考 `前后端联调说明.md`
4. 运行签名对比测试

---

**祝测试顺利! 💪**
