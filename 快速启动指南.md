# 🚀 快速启动指南

> 5分钟完成前后端联调测试

---

## 📋 前置检查

确保以下工具已安装:
- [ ] Java 17+
- [ ] Maven 3.6+
- [ ] 微信开发者工具
- [ ] Redis (后端缓存需要)

---

## 🔧 第一步: 启动后端服务

### 方式一: 命令行启动 (推荐)

```bash
# 1. 进入后端项目目录
cd D:\project\szbz

# 2. 启动Redis (如果未启动)
# Windows: 
# redis-server.exe
# 或者跳过此步,后端会提示Redis连接失败但不影响主要功能

# 3. 启动Spring Boot应用
mvn spring-boot:run
```

### 方式二: IDE启动

1. 用IDEA/VSCode打开 `D:\project\szbz`
2. 运行主类: `SzbzApiApplication.java`

### 验证后端启动成功

看到以下日志表示成功:
```
Started SzbzApiApplication in 3.xxx seconds
Tomcat started on port(s): 8080 (http)
```

浏览器访问: `http://localhost:8080` 应该能看到响应

---

## 📱 第二步: 启动小程序

### 1. 打开微信开发者工具

### 2. 导入项目
- 点击 `导入项目`
- 选择目录: `d:\project\szbzMiniApp`
- AppID: 使用测试号或输入自己的AppID

### 3. 关闭域名校验
- 点击右上角 `详情`
- 勾选 `不校验合法域名、web-view、TLS版本及HTTPS证书`

### 4. 编译运行
- 点击 `编译`
- 等待编译完成

---

## 🧪 第三步: 测试联调

### 1. 填写表单
在首页填写:
- 性别: 选择 `男` 或 `女`
- 出生年月日: 例如 `2014年6月15日`
- 时辰: 选择 `午时`

### 2. 点击提交
点击页面底部的提交按钮

### 3. 查看结果

**正常情况:**
- 显示 "正在分析中..." (约1-3秒)
- 展示生辰八字和AI分析内容

**异常情况:**
- "网络请求失败" → 检查后端是否启动
- "签名验证失败" → 检查前后端签名密钥是否一致
- "请求已过期" → 检查系统时间是否同步

### 4. 查看控制台日志

在微信开发者工具的 `Console` 面板查看:
```
请求参数: {openId: "test_openid_...", gender: "male", ...}
时间戳: 1702800000000
签名: a1b2c3d4e5f6...
接口返回: {code: 200, message: "success", ...}
```

---

## 🔍 第四步: 验证签名算法 (可选)

### 前端测试

在微信开发者工具控制台输入:
```javascript
const test = require('./utils/test-crypto.js')
test.runAllTests()
```

### 后端测试

在命令行运行:
```bash
cd D:\project\szbz
mvn test -Dtest=SignatureUtilTest#printSignatureGenerationSteps
```

### 对比结果
确保前后端生成的签名完全一致!

---

## 📊 测试数据示例

### 测试用例1: 基本测试
```
性别: 男
出生: 2014年6月15日
时辰: 午时
```

### 测试用例2: 女性测试
```
性别: 女
出生: 1990年12月25日
时辰: 辰时
```

### 测试用例3: 边界测试
```
性别: 男
出生: 1950年1月1日
时辰: 子时
```

---

## ❗ 常见问题

### Q1: 后端启动报错 "Redis连接失败"
**A:** 
- 方式1: 启动Redis服务
- 方式2: 暂时注释掉Redis相关配置(会失去缓存功能)

### Q2: 小程序报错 "request:fail"
**A:** 
- 检查后端是否在 `localhost:8080` 运行
- 检查微信开发者工具是否关闭了域名校验

### Q3: 显示 "签名验证失败"
**A:** 
- 检查 `crypto.js` 中的 `SIGN_KEY` 是否为 `szbz-api-sign-key-2024`
- 运行前后端签名测试对比结果

### Q4: 显示 "请求已过期"
**A:** 
- 后端限制时间戳在2秒内有效
- 检查系统时间是否准确
- 确保前后端服务器时间同步

### Q5: 返回数据但格式错乱
**A:** 
- 检查后端Gemini API是否正常返回
- 查看 `formatAnalysisContent()` 方法逻辑
- 检查控制台的 `接口返回` 日志

---

## 🎯 成功标志

看到以下内容表示联调成功:

```
【基本信息】
性别：男
出生时间：2014年6月15日 11时

【生辰八字】
年柱：甲午
月柱：庚午
日柱：戊申
时柱：壬午

【AI智能分析】
(AI生成的详细分析内容)
```

---

## 📚 相关文档

- [前后端联调说明.md](./前后端联调说明.md) - 详细的技术实现文档
- [前后端联调完成总结.md](./前后端联调完成总结.md) - 项目总结报告

---

## 🆘 需要帮助?

如遇到问题,请按以下顺序排查:

1. **查看控制台日志** (微信开发者工具 Console)
2. **查看后端日志** (Spring Boot启动窗口)
3. **运行签名测试** (验证前后端签名一致性)
4. **检查网络连接** (确保localhost:8080可访问)

还有问题? 查看详细文档或联系开发者!

---

**祝测试顺利! 🎉**
